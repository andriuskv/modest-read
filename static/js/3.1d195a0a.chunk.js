(this["webpackJsonpmodest-read"]=this["webpackJsonpmodest-read"]||[]).push([[3,7],Array(30).concat([function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(0),i=n.n(a);function r({name:e,title:t,size:n="20px",className:a,style:r={}}){const c={grid:"M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V12H4M4,11H9V5H4V11Z",list:"M9,5V9H21V5M9,19H21V15H9M9,14H21V10H9M4,9H8V5H4M4,19H8V15H4M4,14H8V10H4V14Z",trash:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",settings:"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",menu:"M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z",close:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z","dots-vertical":"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",upload:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z","circle-cross":"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z","circle-check":"M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z",bookshelf:"M9 3V18H12V3H9M12 5L16 18L19 17L15 4L12 5M5 5V18H8V5H5M3 19V21H21V19H3Z",book:"M6.012,18H21V4c0-1.104-0.896-2-2-2H6C4.794,2,3,2.799,3,5v3v6v3v2c0,2.201,1.794,3,3,3h15v-2H6.012 C5.55,19.988,5,19.805,5,19S5.55,18.012,6.012,18z M8,6h9v2H8V6z","open-book":"M19 2L14 6.5V17.5L19 13V2M6.5 5C4.55 5 2.45 5.4 1 6.5V21.16C1 21.41 1.25 21.66 1.5 21.66C1.6 21.66 1.65 21.59 1.75 21.59C3.1 20.94 5.05 20.5 6.5 20.5C8.45 20.5 10.55 20.9 12 22C13.35 21.15 15.8 20.5 17.5 20.5C19.15 20.5 20.85 20.81 22.25 21.56C22.35 21.61 22.4 21.59 22.5 21.59C22.75 21.59 23 21.34 23 21.09V6.5C22.4 6.05 21.75 5.75 21 5.5V19C19.9 18.65 18.7 18.5 17.5 18.5C15.8 18.5 13.35 19.15 12 20V6.5C10.55 5.4 8.45 5 6.5 5Z","book-question-mark":"M19,2H6A2.91,2.91,0,0,0,3,5V19a2.91,2.91,0,0,0,3,3H21V20H6a1,1,0,1,1,0-2H21V4A2,2,0,0,0,19,2ZM13.09,16h-1.8V14.2h1.8Zm2.1-6.2c-.5.6-1.3,1-1.7,1.5a2.54,2.54,0,0,0-.4,1.7h-1.8a4.52,4.52,0,0,1,.4-2.45,7.22,7.22,0,0,1,1.7-1.35c1.45-1.34,1.09-3.24-.9-3.4a1.8,1.8,0,0,0-1.8,1.8H8.89A3.6,3.6,0,0,1,12.49,4,3.48,3.48,0,0,1,15.19,9.8Z","book-check-mark":"M19,2H6A2.91,2.91,0,0,0,3,5V19a2.91,2.91,0,0,0,3,3H21V20H6a1,1,0,1,1,0-2H21V4A2,2,0,0,0,19,2ZM9.61,15.75,5,11.15,7.1,9.06l2.51,2.51,7.31-7.32L19,6.34Z","menu-down":"M7,10L12,15L17,10H7Z",reset:"M12,6V9L16,5L12,1V4A8,8 0 0,0 4,12C4,13.57 4.46,15.03 5.24,16.26L6.7,14.8C6.25,13.97 6,13 6,12A6,6 0 0,1 12,6M18.76,7.74L17.3,9.2C17.74,10.04 18,11 18,12A6,6 0 0,1 12,18V15L8,19L12,23V20A8,8 0 0,0 20,12C20,10.43 19.54,8.97 18.76,7.74Z",plus:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",minus:"M19,13H5V11H19V13Z","arrow-up":"M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z","arrow-down":"M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z",info:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",exit:"M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z"};return r={...r,width:n,height:n},i.a.createElement("svg",{viewBox:"0 0 24 24",className:a,style:r},t&&i.a.createElement("title",null,t),i.a.createElement("path",{d:c[e]}))}},function(e,t,n){"use strict";function a(e){document.title=e+" | ModestRead"}function i(...e){return e.join(" ").trimEnd()}async function r(e){const t=await e.getPage(1),n=document.createElement("canvas");let a=t.getViewport({scale:.4});return a.width<162?a=t.getViewport({scale:64.8/a.width}):a.height>240&&(a=t.getViewport({scale:96/a.height})),n.width=a.width,n.height=a.height,await t.render({canvasContext:n.getContext("2d"),viewport:a}).promise,n.toDataURL("image/jpeg",.8)}async function c(e,t){const n=await e.arrayBuffer();return t.getDocument(new Uint8Array(n)).promise}function l(e){const t={};return e.info.Title&&(t.title=e.info.Title),e.info.Author&&(t.author=e.info.Author),t}function o(e){const t=["B","kB","MB","GB"];let n=e,a=0;for(;a<t.length&&!(n<1e3);)n/=1e3,a+=1;return n=a>0?n.toFixed(1):Math.round(n),`${n} ${t[a]}`}n.d(t,"f",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return o}))},function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(33),c=n.n(r);n(34);t.a=function(){return i.a.createElement("img",{src:c.a,className:"banner-image",alt:""})}},function(e,t,n){e.exports=n.p+"static/media/icon-text.9dc879ec.svg"},function(e,t,n){},function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=(n(39),n(69));t.a=function({container:e,toggle:t,body:n,children:c}){const[l,o]=Object(a.useState)({id:Object(r.a)()}),s=Object(a.useCallback)((function({target:e}){const t=e.closest(".dropdown-container");let n=!0;(null===t||void 0===t?void 0:t.id)===l.id&&(n=!e.closest("[data-dropdown-keep]")&&(e.closest("a")||e.closest(".dropdown-btn")));n&&(u.current&&o({id:l.id,visible:!1,reveal:!1}),window.removeEventListener("click",s))}),[l.id]),u=Object(a.useRef)(!1),m=Object(a.useRef)(null);return Object(a.useEffect)(()=>(u.current=!0,()=>{u.current=!1,window.removeEventListener("click",s)}),[s]),Object(a.useEffect)(()=>{if(l.reveal){const e=document.documentElement.offsetHeight,t=m.current.getBoundingClientRect().height;o({...l,onTop:l.top+t>e,visible:!0})}},[l.reveal]),i.a.createElement("div",{id:l.id,className:"dropdown-container"+(e?" "+e.className:"")},i.a.createElement("button",{onClick:function({currentTarget:e}){let t=0;l.visible?window.removeEventListener("click",s):(window.addEventListener("click",s),t=e.getBoundingClientRect().bottom),o({id:l.id,visible:!1,reveal:!l.visible,top:t,onTop:!1})},title:t.title,className:`${t.className}${l.visible?" active":""}`},t.content),i.a.createElement("div",{ref:m,className:`dropdown${n?" "+n.className:""}${l.reveal?" reveal":""}${l.visible?" visible":""}${l.onTop?" top":""}`},c))}},function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=(n(40),n(31)),c=n(30);t.a=function({notification:e,expandable:t,margin:n,children:l,dismiss:o}){const[s,u]=Object(a.useState)(e),[m,d]=Object(a.useState)(!1),f=e.type||"negative";return Object(a.useEffect)(()=>{if(!s.flashing&&s!==e){if(s.value!==e.value)return void u(e);u({...s,flashing:!0}),setTimeout(()=>{u(e)},640)}},[s,e]),i.a.createElement("div",{className:Object(r.a)("notification",f,n?"margin-"+n:"",m?"expanded":"",s.flashing?"flash":"")},i.a.createElement(c.a,{name:"negative"===f?"circle-cross":"circle-check",className:"notification-icon",size:"24px"}),t?i.a.createElement("div",{className:"notification-expandable-content-container"},i.a.createElement("div",{className:"notification-expandable-content"},i.a.createElement("span",null,e.value),i.a.createElement("button",{className:"btn icon-btn notification-btn notification-expand-btn",onClick:function(){d(!m)},title:"Details",style:{transform:`rotateZ(${m?"180deg":"0"})`}},i.a.createElement(c.a,{name:"menu-down"}))),m&&l):i.a.createElement("span",{className:"notification-text"},s.value),i.a.createElement("button",{type:"button",className:"btn icon-btn notification-btn notification-dismiss-btn",onClick:o,title:"Dismiss"},i.a.createElement(c.a,{name:"close"})))}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));const a=JSON.parse(localStorage.getItem("settings"))||{showCategories:!1,layoutType:"grid",invertColors:!1,keepToolbarVisible:!1};function i(){return a}function r(e,t){a[e]=t,localStorage.setItem("settings",JSON.stringify(a))}},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t){},function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return m}));class a{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((n,a)=>{const i=indexedDB.open(e,1);i.onerror=()=>a(i.error),i.onsuccess=()=>n(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(t)}})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((a,i)=>{const r=n.transaction(this.storeName,e);r.oncomplete=()=>a(),r.onabort=r.onerror=()=>i(r.error),t(r.objectStore(this.storeName))}))}}let i;function r(){return i||(i=new a),i}const c=new a("ModestKeep","files");function l(){return function(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}(c).then(e=>Promise.all(e.map(o))).then(m).catch(e=>(console.log(e),[]))}function o(e){return function(e,t=r()){let n;return t._withIDBStore("readonly",t=>{n=t.get(e)}).then(()=>n.result)}(e,c)}function s(e){!function(e,t,n=r()){n._withIDBStore("readwrite",n=>{n.put(t,e)})}(e.id,e,c)}function u(e){return function(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}(e,c).then(()=>!0)}function m(e){const[t,n]=e.reduce((e,t)=>("reading"===t.status?e[0].push(t):e[1].push(t),e),[[],[]]);return function(e){return e.sort((e,t)=>t.accessedAt-e.accessedAt)}(t).concat(function(e){return e.sort((e,t)=>e.createdAt-t.createdAt)}(n))}},function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(11);n(41);t.a=function({file:e,showLink:t,children:n}){return i.a.createElement("li",{className:"file-card"},t?i.a.createElement(r.b,{to:"/viewer/"+e.id,className:"file-card-left",title:"Open "+e.name},i.a.createElement("img",{src:e.coverImage,className:"file-card-image",alt:""})):i.a.createElement("img",{src:e.coverImage,className:"file-card-left file-card-image",alt:""}),i.a.createElement("div",{className:"file-card-info"},i.a.createElement("div",{className:"file-card-title"},e.title||e.name),e.author&&i.a.createElement("div",{className:"file-card-author"},e.author),i.a.createElement("div",{className:"file-card-secondary-info"},e.title&&i.a.createElement("div",{className:"file-card-secondary-info-item file-card-filename"},e.name),i.a.createElement("div",{className:"file-card-secondary-info-item"},e.sizeString)),i.a.createElement("div",{className:"file-card-progress-container",title:`${e.pageNumber} of ${e.pageCount} page${1===e.pageCount?"":"s"} read`},i.a.createElement("div",{className:"file-card-progress"},i.a.createElement("div",{className:"file-card-progress-bar",style:{left:(e.pageNumber-1)/e.pageCount*100+"%"}}))),i.a.createElement("div",{className:"file-card-bottom"},n)))}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){"use strict";var a="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);function r(){if(!a)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(i)}var c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var l=function(e){return"string"===typeof e&&c.test(e)},o=[],s=0;s<256;++s)o.push((s+256).toString(16).substr(1));var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!l(n))throw TypeError("Stringified UUID is invalid");return n};t.a=function(e,t,n){var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=a[i];return t}return u(a)}},,function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(1),c=n(11),l=n(56),o=n(69),s=n(31),u=n(43),m=n(38),d=n(35),f=n(30),p=n(36),v=n(32),b=n(44);n(64);var h=function({file:e,notification:t,dismissNotification:n,handleFileUpload:a,loadNewFile:r}){return i.a.createElement("div",{className:"viewer-file-preview-container"},i.a.createElement(v.a,null),i.a.createElement("div",{className:"viewer-file-preview"},"negative"===(null===t||void 0===t?void 0:t.type)&&i.a.createElement(p.a,{notification:t,margin:"bottom",dismiss:n}),i.a.createElement(b.a,{file:e},i.a.createElement(c.b,{to:"/",className:"btn icon-btn",title:"Back to files"},i.a.createElement(f.a,{name:"bookshelf",size:"24px"})),i.a.createElement("label",{className:"btn viewer-file-preview-import-btn"},i.a.createElement("input",{type:"file",onChange:a,className:"sr-only",accept:"application/pdf"}),i.a.createElement("span",null,"Select File"))),"warning"===(null===t||void 0===t?void 0:t.type)&&i.a.createElement("div",{className:"viewer-file-preview-warning"},i.a.createElement("div",{className:"viewer-file-preview-warning-main"},i.a.createElement(f.a,{name:"info",className:"viewer-file-preview-warning-icon",size:"24px"}),i.a.createElement("p",{className:"viewer-file-preview-warning-message"},t.value)),i.a.createElement("div",{className:"viewer-file-preview-warning-bottom"},i.a.createElement("button",{className:"btn text-btn viewer-file-preview-warning-btn",onClick:n},"No"),i.a.createElement("button",{className:"btn viewer-file-preview-warning-btn",onClick:r},"Yes")))))};n(65);var g=function({file:e}){return i.a.createElement(d.a,{toggle:{content:i.a.createElement(f.a,{name:"info"}),title:"Information",className:"btn icon-btn icon-btn-alt"},body:{className:"file-info"}},i.a.createElement("img",{src:e.coverImage,className:"file-info-image",alt:""}),i.a.createElement("div",null,i.a.createElement("div",{className:"file-info-details-item"},i.a.createElement("span",null,"File name:"),i.a.createElement("span",null,e.name)),i.a.createElement("div",{className:"file-info-details-item"},i.a.createElement("span",null,"File size:"),i.a.createElement("span",null,e.sizeString)),i.a.createElement("div",{className:"file-info-details-item"},i.a.createElement("span",null,"Title: "),i.a.createElement("span",null,e.title||"-")),i.a.createElement("div",{className:"file-info-details-item"},i.a.createElement("span",null,"Author:"),i.a.createElement("span",null,e.author||"-")),i.a.createElement("div",{className:"file-info-details-item"},i.a.createElement("span",null,"Page count:"),i.a.createElement("span",null,e.pageCount))))};n(66);var w=function(){return i.a.createElement("div",{className:"no-file-notice"},i.a.createElement(v.a,null),i.a.createElement("p",{className:"no-file-notice-message"},"File not found."),i.a.createElement(c.b,{to:"/",className:"btn icon-text-btn primary-btn"},i.a.createElement(f.a,{name:"bookshelf",size:"24px"}),i.a.createElement("span",null,"Back to Files")))};n(67);t.default=function(){const e=Object(r.f)(),{id:t}=Object(r.g)(),[n,p]=Object(a.useState)(null),[v,b]=Object(a.useState)(1),[E,L]=Object(a.useState)({name:"1",value:1.3333}),[C,N]=Object(a.useState)(null),[y,V]=Object(a.useState)({}),H=Object(a.useRef)(null),k=Object(a.useRef)(null),M=Object(a.useRef)(!1),A=Object(a.useRef)(0),x=Object(a.useRef)(!1),j=Object(a.useRef)([]),O=Object(a.useRef)(null),T=Object(a.useRef)(0),S=Object(a.useRef)(!1),Z=Object(a.useRef)(!1),D=Object(a.useRef)(0),R=Object(a.useRef)(!1),I=Object(a.useCallback)((function(){if(S.current)return;S.current=!0,requestAnimationFrame(()=>{const{scrollTop:e,scrollLeft:t}=document.documentElement,a=n.file.pageNumber,i=n.file.scrollTop-e;D.current=e>n.file.scrollTop?1:-1,n.file.scrollTop=e<0?0:e,n.file.scrollLeft=t,n.file.pageNumber=function(e,t){for(let n=0;n<e.length-1;n+=1){const a=e[n],i=e[n+1],r=a.top+a.height/2,c=i.top+i.height/2;if(t>=r&&t<=c)return n+2}return 1}(n.views,n.file.scrollTop),M.current||(1===D.current?k.current.classList.contains("hidden")||(A.current=0,k.current.classList.add("hiding"),setTimeout(()=>{k.current.classList.add("hidden")},200)):n.file.scrollTop?A.current>100?z():A.current+=i:z()),M.current=!1,clearTimeout(T.current),T.current=setTimeout(()=>{Object(u.d)(n.file)},1e3),n.file.pageNumber!==a&&(b(n.file.pageNumber),p({...n})),S.current=!1})}),[E]),B=Object(a.useCallback)((function(e){e.clientY<80&&e.clientX<e.currentTarget.clientWidth&&k.current.classList.contains("hidden")&&(k.current.classList.remove("hidden"),setTimeout(()=>{k.current.classList.remove("hiding")},200))}),[E]),P=Object(a.useCallback)((function(e){R.current&&(e.preventDefault(),e.wheelDelta>0?Y():G())}),[E]),F=Object(a.useCallback)((function(e){R.current=e.ctrlKey}),[E]),$=Object(a.useCallback)((function(e){if("INPUT"===e.target.nodeName)return;if(R.current=e.ctrlKey,e.ctrlKey)return"+"===e.key&&(Y(),e.preventDefault()),void("-"===e.key&&(G(),e.preventDefault()));const{scrollWidth:t,offsetWidth:n}=document.documentElement;t<=n&&("ArrowLeft"===e.key?(X(),e.preventDefault()):"ArrowRight"===e.key&&(Q(),e.preventDefault()))}),[E,v]);function z(){k.current.classList.contains("hidden")&&(A.current=0,k.current.classList.remove("hidden"),setTimeout(()=>{k.current.classList.remove("hiding")},200))}async function W(e){const t=[];for(let n=0;n<e.numPages;n+=1){const a=await e.getPage(n+1),{width:i,height:r}=a.getViewport({scale:1});t.push({width:i,height:r})}return t}async function U(e,t,n,a){const i=document.createElement("div"),r=(await a.getPage(e)).getViewport({scale:t.value});i.style.width=Math.floor(r.width)+"px",i.style.height=Math.floor(r.height)+"px",i.setAttribute("data-page-number",e),i.classList.add("viewer-page"),n.appendChild(i)}async function K(e,t){const n=new DocumentFragment,a=[];for(let i=0;i<e.numPages;i+=1)a.push(U(i+1,t,n,e));await Promise.all(a),H.current.appendChild(n)}async function _(e,t=null,a=null){const i=t||n.file;i.scale=i.scale||{name:"1",value:1.3333},i.pageNumber=i.pageNumber||1;const r=a||await Object(s.c)(e,l),[{maxWidth:c,maxHeight:o},m]=await Promise.all([J(r),W(r),K(r,i.scale)]);delete n.filePreviewVisible,p({...n,instance:r,pageDimensions:m,file:i,maxWidth:c,maxHeight:o}),window.scrollTo(i.scrollLeft,i.scrollTop),L(i.scale),b(i.pageNumber),"read"!==i.status&&(1===i.pageCount?i.status="read":i.status="reading"),i.accessedAt=Date.now(),Object(u.d)(i)}async function J(e){let t=0,n=0;for(let a=1;a<3;a+=1){const i=await e.getPage(a),{width:r,height:c}=i.getViewport({scale:1});r>t&&(t=r),c>n&&(n=c)}return{maxWidth:Math.floor(t),maxHeight:Math.floor(n)}}async function q(e){let t=1.3333;if("fit-width"===e.target.value){t=(document.documentElement.offsetWidth-16)/n.maxWidth}else if("fit-page"===e.target.value){const{keepToolbarVisible:e}=y;t=(document.documentElement.offsetHeight-(e?56:16))/n.maxHeight}else t=1.3333*e.target.value;Z.current=!0,L({name:e.target.value,value:t})}function G(){Z.current=!0,L({name:"custom",value:Math.max(E.value/1.1,.333325)})}function Y(){Z.current=!0,L({name:"custom",value:Math.min(1.1*E.value,13.333)})}function X(){M.current=!0,ce(v-1)}function Q(){M.current=!0,ce(v+1)}function ee(e){"Enter"===e.key&&e.target.blur()}function te(e){let t=parseInt(e.target.value,10);Number.isNaN(t)?t=n.file.pageNumber:t<1?t=1:t>n.file.pageCount&&(t=n.file.pageCount),e.target.style.width=t.toString().length+"ch",t!==v&&(M.current=!0,ce(t))}function ne(e){b(e.target.value)}function ae(e){e.target!==e.currentTarget.firstElementChild&&e.currentTarget.firstElementChild.focus()}function ie(e){const t=n.file.pageCount<1e3?4:n.file.pageCount.toString().length;e.target.style.width=t+"ch",e.target.select()}function re(e,t){for(const n of H.current.children)if(parseInt(n.getAttribute("data-page-number"),10)===e)return t(n)}function ce(e){re(e,e=>{const t=y.keepToolbarVisible?40:0;window.scrollTo(n.file.scrollLeft,e.offsetTop-t)})}function le({target:e}){V({...y,[e.name]:e.checked}),Object(m.b)(e.name,e.checked)}return Object(a.useEffect)(()=>(async function(){if(e.location.state)return;const n=await Object(u.b)(t);n?(p({file:n,filePreviewVisible:!0}),V(Object(m.a)()),Object(s.f)(n.name),document.body.style.overscrollBehavior="none"):(p({error:!0}),Object(s.f)("Error"))}(),()=>{document.body.style.overscrollBehavior=""}),[t]),Object(a.useEffect)(()=>{if(!n||!n.instance)return;const e=H.current;return e.addEventListener("mousemove",B),window.addEventListener("scroll",I),window.addEventListener("wheel",P,{passive:!1}),window.addEventListener("keyup",F),()=>{e.removeEventListener("mousemove",B),window.removeEventListener("scroll",I),window.removeEventListener("wheel",P,{passive:!1}),window.removeEventListener("keyup",F)}},[I,B,P,F]),Object(a.useEffect)(()=>(window.addEventListener("keydown",$),()=>{window.removeEventListener("keydown",$)}),[$]),Object(a.useEffect)(()=>{n&&n.instance&&(!function(e){const t=document.documentElement.scrollLeft,{top:a}=re(v,e=>e.getBoundingClientRect());!function(e){for(const[t,a]of Object.entries(H.current.children)){const i=n.pageDimensions[t],r=Math.floor(i.width*e),c=Math.floor(i.height*e);if(a.style.width=r+"px",a.style.height=c+"px",a.hasAttribute("data-loaded")){const e=a.firstElementChild,{width:t}=e;r===t?(e.style.width="",e.style.height="",a.removeAttribute("data-rerender-needed")):(e.style.width=r+"px",e.style.height=c+"px",a.setAttribute("data-rerender-needed",!0))}}}(e.value),n.file.scale=e,n.views=Array.from(H.current.children).map(e=>({top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight})),n.file.scrollTop=n.views[v-1].top-a*e.value/n.file.scale.value,n.file.scrollLeft=t*e.value/n.file.scale.value,n.pagesInViewport=function(e){const t=Math.ceil(document.documentElement.offsetHeight/((e[0].height+e[1].height)/2));if(t<2)return 2;return t}(n.views),window.scrollTo(n.file.scrollLeft,n.file.scrollTop),p({...n}),Object(u.d)(n.file)}(E),O.current&&O.current.disconnect(),O.current=new IntersectionObserver((function(e){e.forEach(({isIntersecting:e,target:t})=>{!e||t.hasAttribute("data-loaded")&&!t.hasAttribute("data-rerender-needed")||(x.current?j.current.push(t):(x.current=!0,t.setAttribute("data-loaded","true"),async function e(t){const a=parseInt(t.getAttribute("data-page-number"),10),i=n.pageDimensions[a-1],r=Math.floor(i.width*E.value),c=Math.floor(i.height*E.value),o=document.createElement("canvas");let s=null,u=null;o.classList.add("viewer-page-canvas"),t.hasAttribute("data-rerender-needed")?(u=t.firstElementChild,s=t.lastElementChild,s.innerHTML="",t.removeAttribute("data-rerender-needed")):(s=document.createElement("div"),s.classList.add("viewer-page-text"),t.appendChild(o),t.appendChild(s));const m=await n.instance.getPage(a),d=m.getViewport({scale:E.value});o.width=r%2===0?r:r+1,o.height=c+1,s.style.width=r+"px",s.style.height=c+"px",await m.render({canvasContext:o.getContext("2d"),enableWebGL:!0,viewport:d}).promise,requestAnimationFrame(async()=>{l.renderTextLayer({textContent:await m.getTextContent(),container:s,viewport:d,textDivs:[]})}),u&&t.replaceChild(o,u);if(j.current.length)for(;j.current.length;){const t=1===D.current?j.current.pop():j.current.shift();t.setAttribute("data-loaded","true"),e(t)}else x.current=!1}(t)))})}),{rootMargin:n.maxHeight*n.file.scale.value+"px 0px"}),Array.from(H.current.children).forEach(e=>{O.current.observe(e)}),Z.current=!1)},[E]),(null===n||void 0===n?void 0:n.error)?i.a.createElement(w,null):i.a.createElement(i.a.Fragment,null,(null===n||void 0===n?void 0:n.filePreviewVisible)&&i.a.createElement(h,{file:n.file,notification:C,dismissNotification:function(){N(null)},handleFileUpload:async function(e){const[t]=e.target.files;t.name.endsWith(".pdf")?t.name!==n.file.name?N({file:t,type:"warning",value:"File does not match currently loaded file.\nDo you want to load it anyway?"}):_(t):N({file:t,type:"negative",value:"File is not supported."}),e.target.value=""},loadNewFile:async function(){const{file:t}=C;let n=(await Object(u.c)()).find(({name:e})=>e===t.name),a=null;if(!n){a=await Object(s.c)(t,l);const[e,i]=await Promise.all([a.getMetadata(),Object(s.d)(a)]);n={...Object(s.e)(e),id:Object(o.a)(),name:t.name,createdAt:Date.now(),scale:{name:"1",value:1.3333},pageCount:a.numPages,coverImage:i}}_(t,n,a),e.replace({pathname:"/viewer/"+n.id,state:!0}),Object(s.f)(n.name)}}),(null===n||void 0===n?void 0:n.instance)&&i.a.createElement("div",{className:"viewer-toolbar"+(y.keepToolbarVisible?" keep-visible":""),ref:k},i.a.createElement(g,{file:n.file}),i.a.createElement("div",{className:"viewer-toolbar-tools"},i.a.createElement("div",{className:"viewer-toolbar-zoom"},i.a.createElement("button",{className:"btn icon-btn viewer-toolbar-tool-btn",onClick:G,title:"Zoom out",disabled:Z.current||E.value<=.333325},i.a.createElement(f.a,{name:"minus"})),i.a.createElement("select",{className:"input viewer-toolbar-zoom-select",onChange:q,value:E.name,disabled:Z.current},i.a.createElement("option",{value:"custom",style:{display:"none"}},Math.round(100*E.value/1.3333),"%"),i.a.createElement("option",{value:"fit-width"},"Fit Width"),i.a.createElement("option",{value:"fit-page"},"Fit Page"),i.a.createElement("option",{value:"0.5"},"50%"),i.a.createElement("option",{value:"0.75"},"75%"),i.a.createElement("option",{value:"1"},"100%"),i.a.createElement("option",{value:"1.5"},"150%"),i.a.createElement("option",{value:"2"},"200%"),i.a.createElement("option",{value:"3"},"300%"),i.a.createElement("option",{value:"4"},"400%")),i.a.createElement("button",{className:"btn icon-btn viewer-toolbar-tool-btn",onClick:Y,title:"Zoom in",disabled:Z.current||E.value>=13.333},i.a.createElement(f.a,{name:"plus"}))),i.a.createElement("div",{className:"viewer-toolbar-page"},i.a.createElement("button",{className:"btn icon-btn viewer-toolbar-tool-btn",onClick:X,disabled:n.file.pageNumber<=1},i.a.createElement(f.a,{name:"arrow-up"})),i.a.createElement("div",{className:"viewer-toolbar-page-input-container",onClick:ae},i.a.createElement("input",{type:"text",inputMode:"numeric",className:"input viewer-toolbar-page-input",onChange:ne,value:v,onBlur:te,onFocus:ie,onKeyDown:ee,style:{width:n.file.pageNumber.toString().length+"ch"}}),i.a.createElement("div",null,"of ",n.file.pageCount)),i.a.createElement("button",{className:"btn icon-btn viewer-toolbar-tool-btn",onClick:Q,disabled:n.file.pageNumber>=n.file.pageCount},i.a.createElement(f.a,{name:"arrow-down"})))),i.a.createElement(d.a,{container:{className:"viewer-toolbar-settings-container"},toggle:{content:i.a.createElement(f.a,{name:"settings"}),title:"Settings",className:"btn icon-btn icon-btn-alt"},body:{className:"viewer-toolbar-settings"}},i.a.createElement("label",{className:"viewer-toolbar-settings-item"},i.a.createElement("input",{type:"checkbox",className:"sr-only checkbox-input",name:"invertColors",onChange:le,checked:y.invertColors}),i.a.createElement("div",{className:"checkbox"},i.a.createElement("div",{className:"checkbox-tick"})),i.a.createElement("span",{className:"checkbox-label"},"Invert page colors.")),i.a.createElement("label",{className:"viewer-toolbar-settings-item"},i.a.createElement("input",{type:"checkbox",className:"sr-only checkbox-input",name:"keepToolbarVisible",onChange:le,checked:y.keepToolbarVisible}),i.a.createElement("div",{className:"checkbox"},i.a.createElement("div",{className:"checkbox-tick"})),i.a.createElement("span",{className:"checkbox-label"},"Keep toolbar visible."))),i.a.createElement(c.b,{to:"/",className:"btn icon-btn icon-btn-alt",title:"Exit"},i.a.createElement(f.a,{name:"exit"}))),i.a.createElement("div",{className:"viewer-pdf"+(y.invertColors?" invert":""),ref:H}))}}])]);